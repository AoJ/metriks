{"name":"Metriks","tagline":"A simpler graphing framework","body":"# Metriks\r\n\r\n<!-- badges/ -->\r\n[![Build Status](https://secure.travis-ci.org/kvz/metriks.png?branch=master)](http://travis-ci.org/kvz/metriks \"Check this project's build status on TravisCI\")\r\n[![NPM version](http://badge.fury.io/js/metriks.png)](https://npmjs.org/package/metriks \"View this project on NPM\")\r\n[![Dependency Status](https://david-dm.org/kvz/metriks.png?theme=shields.io)](https://david-dm.org/kvz/metriks)\r\n[![Development Dependency Status](https://david-dm.org/kvz/metriks/dev-status.png?theme=shields.io)](https://david-dm.org/kvz/metriks#info=devDependencies)\r\n\r\n[![Gittip donate button](http://img.shields.io/gittip/kvz.png)](https://www.gittip.com/kvz/ \"Sponsor the development of metriks via Gittip\")\r\n[![Flattr donate button](http://img.shields.io/flattr/donate.png?color=yellow)](https://flattr.com/submit/auto?user_id=kvz&url=https://github.com/kvz/metriks&title=metriks&language=&tags=github&category=software \"Sponsor the development of metriks via Flattr\")\r\n[![PayPayl donate button](http://img.shields.io/paypal/donate.png?color=yellow)](https://www.paypal.com/cgi-bin/webscr?cmd=_donations&business=kevin%40vanzonneveld%2enet&lc=NL&item_name=Open%20source%20donation%20to%20Kevin%20van%20Zonneveld&currency_code=USD&bn=PP-DonationsBF%3abtn_donate_SM%2egif%3aNonHosted \"Sponsor the development of metriks via Paypal\")\r\n[![BitCoin donate button](http://img.shields.io/bitcoin/donate.png?color=yellow)](https://coinbase.com/checkouts/19BtCjLCboRgTAXiaEvnvkdoRyjd843Dg2 \"Sponsor the development of metriks via BitCoin\")\r\n<!-- /badges -->\r\n\r\n## Features\r\n\r\n - Builds on `rrdtool`. The network industry standard of saving time-series data to disk with a constant storage footprint.\r\n - Builds on `nodejs` for optimal concurrency and the ability to run a server without dealing with cgi-bin, etc.\r\n - Minimal dependencies. If you have node.js/npm working, all you need is `aptitude install rrdtool` and you're ready to go\r\n - Writes RRDs & images to disk, so it works when everything else is down.\r\n - Idempotent. Metriks will create graphs that don't exist, and generally be eager to get you results.\r\n - Trivial to add graphs. It should Just Work by default. Write a plugin file in any language. If it outputs a single number, metriks will graph it for you. You can optionally output configuration strings like `# config.interval: 60` or `# graph.title: Load average` to finetune behavior. Newlines (`\\n`) separate graph lines. Other whitespaces separate graph label from value. See the [load plugin](https://github.com/kvz/metriks/blob/master/plugins/load.sh) for an example how to plot 3 load lines: 1 minute, 5 minute, 15 minute averages. \r\n - Can send out alerts when metrics go outside boundaries\r\n\r\nMetriks is basic. If you want advanced, there are plenty of options out there like graphite, mrtg, or (paid) librato. You may also want to have a look at druid, riemann and grafana.\r\nHowever **Metriks will never**:\r\n\r\n - Require you to deal with perl / cgi-bin / xml / apache / etc\r\n - Impose steep learning curves\r\n - Require networked components to be available to do it's job (in favor of graphing locally, optionally aggregating & uploading to e.g. S3)\r\n - Get in your way\r\n - Ask for money\r\n\r\n## Example\r\n\r\nHere we'll add a simple graph with response times to different nameservers that looks like this:\r\n\r\n![kvz-imac-home-4 local-ping 1](https://f.cloud.github.com/assets/26752/2184319/a854bf90-97bd-11e3-9d78-8ba0b7178952.png)\r\n\r\nTo achieve this, open a text file `./plugins/ping.sh`, `chmod +x` it, and make it say:\r\n\r\n```bash\r\necho \"# config.interval: 60\"\r\necho \"# graph.title: Ping resolving nameservers\"\r\necho \"# graph.verticalLabel: Roundtrip in ms\"\r\n\r\nfor server in 8.8.8.8 4.2.2.2 208.67.222.222 172.16.0.23; do\r\n  echo \"ip_${server} $(ping -c 4 ${server} |tail -1 |awk '{print $4}' |cut -d '/' -f 2)\"\r\ndone\r\n```\r\n\r\n## Options\r\n\r\nIf you want to keep your plugin files outside of the Metriks source directory, simply point metriks to your own plugin dir via:\r\n\r\n```bash\r\nmetriks --plugin-dir ~/metriks/plugins\r\n```\r\n\r\nBy default, metriks writes rrds files to `~/metriks/rrd` and images to `~/metriks/png`. But you can change that with\r\n\r\n```bash\r\nmetriks --rrd-dir /var/lib/rrd\r\nmetriks --png-dir /var/www/graphs\r\n```\r\n\r\nMetriks contains an simple webserver so you can browse the `png` dir via: \r\n\r\n```bash\r\nmetriks --web-port 8000\r\n```\r\n\r\nIf you don't want to automatically build png files but are only interested in gathering data in rrd, use\r\n\r\n```bash\r\nmetriks --auto-write-png false\r\n```\r\n\r\n## Todo\r\n\r\nMetriks is still in early stages of development, here's what needs to be done still:\r\n\r\n - [ ] More advanced rrd types (COUNTER vs GAUGE, ability to add a custom step, AREA graphs) as req in [#1](https://github.com/kvz/metriks/issues/1)\r\n - [ ] Offer an API that so that you can programatically add values in Nodejs programs. e.g. `require('metriks').graph('df').addSeries([{'/': '50%'}])`\r\n - [ ] Checkout smokeping sources and try to build a plugin very similar to it. This should expose some limitations and make it more usable in different environments after fixing those.\r\n - [ ] Example plugin: network traffic\r\n - [ ] Example plugin: top-10 memory heavy processes (may require \"Dynamically expand ds\" first)\r\n - [ ] Example plugins: http://word.bitly.com/post/74839060954/ten-things-to-monitor?h=2\r\n - [ ] Something that can generate an index page/json of rrd/images\r\n - [ ] Upload to s3 as a step after rrd -> graph -> upload\r\n - [ ] Aggregate datasources into 1 graph using glob\r\n - [ ] Support for max & min values and a way to communicate problems to the outside world\r\n - [ ] Dynamically expand ds using rrdtool dump / import. It's hard, see http://stackoverflow.com/questions/13476226/adding-new-datasource-to-an-existing-rrd\r\n - [ ] More unit test coverage\r\n - [ ] Don't crash the main process on plugin fatals.\r\n - [ ] Show min, max, avg for every ds on every graph by default\r\n - [ ] Should we ship an `upstart` file so people can daemonize/respawn/log metriks easily on ubuntu?\r\n - [x] Install bin globally\r\n - [x] Add example section to readme with screenshots and plugin code\r\n - [x] Configurable line titles vs hardcoded ds name\r\n - [x] Upgrade flat once [this](https://github.com/hughsk/flat/issues/6) bug has been resolved. Until then, prefix all ds keys with a letter.\r\n - [x] Offer an optional webserver via e.g. [send](https://github.com/visionmedia/send) so you can browse through the generated pngs\r\n - [x] _.findWhere\r\n - [x] Refactoring: Plugin\r\n - [x] Refactoring: pluginmanager\r\n - [x] Refactoring: rrdtool\r\n - [x] Refactoring: cli\r\n - [x] Retire thong.tmpl for _.template\r\n - [x] Retire thong.sprintf for util.format\r\n - [x] Retire commander for cli\r\n - [x] Visually show integration test\r\n - [x] One integration test\r\n - [x] Test cases\r\n - [x] Explodetree/flatten, use it for plug-in config (linecolour slice to array) and rrdtool info\r\n - [x] _.isNumeric\r\n - [x] Librato colors\r\n - [x] Graph options need to be interpretted\r\n - [x] Configurable y-axis\r\n - [x] Lose rrd.js over rrdtool.js\r\n - [x] Async.parallel jobs\r\n - [x] Support for .go plugins\r\n\r\n## Prerequisites\r\n\r\nI'm assuming you already have [node 0.8+](http://nodejs.org/download/) and [Git](http://git-scm.com/downloads) available.\r\n\r\n### OSX\r\n\r\nTo run rrdtool on OSX you'll need [XQuartz](http://xquartz.macosforge.org). Then via [Homebrew](http://brew.sh/):\r\n\r\n```bash\r\nbrew install rrdtool coreutils\r\n```\r\n\r\ncoreutils is required for `timeout`, used in integration tests.\r\n\r\n### Ubuntu\r\n\r\n```bash\r\naptitude install rrdtool\r\n```\r\n\r\n## Install\r\n\r\n\r\n### Globally\r\n\r\n```bash\r\nnpm install -g metriks\r\n```\r\n\r\n### Development\r\n\r\n```bash\r\ngit clone https://github.com/kvz/metriks.git\r\ncd metriks\r\nnpm install\r\n```\r\n\r\n## Run\r\n\r\nWith debug output, and a built-in webserver to browser resulting png graphs on port 8000\r\n\r\n```bash\r\n./bin/metriks --debug --web-port 8000\r\n```\r\n\r\n## Test\r\n\r\n```bash\r\nmake test\r\n```\r\n\r\n## License\r\n\r\n[MIT LICENSE](LICENSE)\r\n\r\n\r\n\r\n\r\n\r\n/usr/bin/rrdtool graph - \\\r\n\"--start\" \\\r\n\"-10800\" \\\r\n\"--end\" \\\r\n\"now\" \\\r\n\"--height\" \\\r\n\"200\" \\\r\n\"--width\" \\\r\n\"600\" \\\r\n\"--title\" \\\r\n\"Latency Graph\" \\\r\n\"--rigid\" \\\r\n\"--lower-limit\" \\\r\n\"0\" \\\r\n\"--vertical-label\" \\\r\n\"Seconds\" \\\r\n\"--imgformat\" \\\r\n\"PNG\" \\\r\n\"--color\" \\\r\n\"SHADEA#ffffff\" \\\r\n\"--color\" \\\r\n\"SHADEB#ffffff\" \\\r\n\"--color\" \\\r\n\"BACK#ffffff\" \\\r\n\"--color\" \\\r\n\"CANVAS#ffffff\" \\\r\n\"DEF:ping1=/var/lib/smokeping/.rrd:ping1:AVERAGE\" \\\r\n\"DEF:ping2=/var/lib/smokeping/.rrd:ping2:AVERAGE\" \\\r\n\"DEF:ping3=/var/lib/smokeping/.rrd:ping3:AVERAGE\" \\\r\n\"DEF:ping4=/var/lib/smokeping/.rrd:ping4:AVERAGE\" \\\r\n\"DEF:ping5=/var/lib/smokeping/.rrd:ping5:AVERAGE\" \\\r\n\"DEF:ping6=/var/lib/smokeping/.rrd:ping6:AVERAGE\" \\\r\n\"DEF:ping7=/var/lib/smokeping/.rrd:ping7:AVERAGE\" \\\r\n\"DEF:ping8=/var/lib/smokeping/.rrd:ping8:AVERAGE\" \\\r\n\"DEF:ping9=/var/lib/smokeping/.rrd:ping9:AVERAGE\" \\\r\n\"DEF:ping10=/var/lib/smokeping/.rrd:ping10:AVERAGE\" \\\r\n\"DEF:ping11=/var/lib/smokeping/.rrd:ping11:AVERAGE\" \\\r\n\"DEF:ping12=/var/lib/smokeping/.rrd:ping12:AVERAGE\" \\\r\n\"DEF:ping13=/var/lib/smokeping/.rrd:ping13:AVERAGE\" \\\r\n\"DEF:ping14=/var/lib/smokeping/.rrd:ping14:AVERAGE\" \\\r\n\"DEF:ping15=/var/lib/smokeping/.rrd:ping15:AVERAGE\" \\\r\n\"DEF:ping16=/var/lib/smokeping/.rrd:ping16:AVERAGE\" \\\r\n\"DEF:ping17=/var/lib/smokeping/.rrd:ping17:AVERAGE\" \\\r\n\"DEF:ping18=/var/lib/smokeping/.rrd:ping18:AVERAGE\" \\\r\n\"DEF:ping19=/var/lib/smokeping/.rrd:ping19:AVERAGE\" \\\r\n\"DEF:ping20=/var/lib/smokeping/.rrd:ping20:AVERAGE\" \\\r\n\"CDEF:cp1=ping1,0.08767488,LT,ping1,INF,IF\" \\\r\n\"CDEF:cp2=ping2,0.08767488,LT,ping2,INF,IF\" \\\r\n\"CDEF:cp3=ping3,0.08767488,LT,ping3,INF,IF\" \\\r\n\"CDEF:cp4=ping4,0.08767488,LT,ping4,INF,IF\" \\\r\n\"CDEF:cp5=ping5,0.08767488,LT,ping5,INF,IF\" \\\r\n\"CDEF:cp6=ping6,0.08767488,LT,ping6,INF,IF\" \\\r\n\"CDEF:cp7=ping7,0.08767488,LT,ping7,INF,IF\" \\\r\n\"CDEF:cp8=ping8,0.08767488,LT,ping8,INF,IF\" \\\r\n\"CDEF:cp9=ping9,0.08767488,LT,ping9,INF,IF\" \\\r\n\"CDEF:cp10=ping10,0.08767488,LT,ping10,INF,IF\" \\\r\n\"CDEF:cp11=ping11,0.08767488,LT,ping11,INF,IF\" \\\r\n\"CDEF:cp12=ping12,0.08767488,LT,ping12,INF,IF\" \\\r\n\"CDEF:cp13=ping13,0.08767488,LT,ping13,INF,IF\" \\\r\n\"CDEF:cp14=ping14,0.08767488,LT,ping14,INF,IF\" \\\r\n\"CDEF:cp15=ping15,0.08767488,LT,ping15,INF,IF\" \\\r\n\"CDEF:cp16=ping16,0.08767488,LT,ping16,INF,IF\" \\\r\n\"CDEF:cp17=ping17,0.08767488,LT,ping17,INF,IF\" \\\r\n\"CDEF:cp18=ping18,0.08767488,LT,ping18,INF,IF\" \\\r\n\"CDEF:cp19=ping19,0.08767488,LT,ping19,INF,IF\" \\\r\n\"CDEF:cp20=ping20,0.08767488,LT,ping20,INF,IF\" \\\r\n\"DEF:loss=/var/lib/smokeping/.rrd:loss:AVERAGE\" \\\r\n\"CDEF:smoke1=cp1,UN,UNKN,cp20,cp1,-,IF\" \\\r\n\"AREA:cp1\" \\\r\n\"STACK:smoke1#dddddd\" \\\r\n\"CDEF:smoke2=cp2,UN,UNKN,cp19,cp2,-,IF\" \\\r\n\"AREA:cp2\" \\\r\n\"STACK:smoke2#cacaca\" \\\r\n\"CDEF:smoke3=cp3,UN,UNKN,cp18,cp3,-,IF\" \\\r\n\"AREA:cp3\" \\\r\n\"STACK:smoke3#b7b7b7\" \\\r\n\"CDEF:smoke4=cp4,UN,UNKN,cp17,cp4,-,IF\" \\\r\n\"AREA:cp4\" \\\r\n\"STACK:smoke4#a4a4a4\" \\\r\n\"CDEF:smoke5=cp5,UN,UNKN,cp16,cp5,-,IF\" \\\r\n\"AREA:cp5\" \\\r\n\"STACK:smoke5#919191\" \\\r\n\"CDEF:smoke6=cp6,UN,UNKN,cp15,cp6,-,IF\" \\\r\n\"AREA:cp6\" \\\r\n\"STACK:smoke6#7e7e7e\" \\\r\n\"CDEF:smoke7=cp7,UN,UNKN,cp14,cp7,-,IF\" \\\r\n\"AREA:cp7\" \\\r\n\"STACK:smoke7#6b6b6b\" \\\r\n\"CDEF:smoke8=cp8,UN,UNKN,cp13,cp8,-,IF\" \\\r\n\"AREA:cp8\" \\\r\n\"STACK:smoke8#585858\" \\\r\n\"CDEF:smoke9=cp9,UN,UNKN,cp12,cp9,-,IF\" \\\r\n\"AREA:cp9\" \\\r\n\"STACK:smoke9#454545\" \\\r\n\"CDEF:smoke10=cp10,UN,UNKN,cp11,cp10,-,IF\" \\\r\n\"AREA:cp10\" \\\r\n\"STACK:smoke10#323232\" \\\r\n\"DEF:median=/var/lib/smokeping/.rrd:median:AVERAGE\" \\\r\n\"CDEF:ploss=loss,20,/,100,*\" \\\r\n\"VDEF:avmed=median,AVERAGE\" \\\r\n\"CDEF:mesd=median,POP,avmed,0.00692652790837922,/\" \\\r\n\"GPRINT:avmed:median rtt\\: %.1lf %ss avg\" \\\r\n\"GPRINT:median:MAX:%.1lf %ss max\" \\\r\n\"GPRINT:median:MIN:%.1lf %ss min\" \\\r\n\"GPRINT:median:LAST:%.1lf %ss now\" \\\r\n\"COMMENT:6.9 ms sd\" \\\r\n\"GPRINT:mesd:AVERAGE:%.1lf %s am/s\\l\" \\\r\n\"LINE1:median#202020\" \\\r\n\"GPRINT:ploss:AVERAGE:packet loss\\: %.2lf %% avg\" \\\r\n\"GPRINT:ploss:MAX:%.2lf %% max\" \\\r\n\"GPRINT:ploss:MIN:%.2lf %% min\" \\\r\n\"GPRINT:ploss:LAST:%.2lf %% now\\l\" \\\r\n\"COMMENT:loss color\\:\" \\\r\n\"CDEF:me0=loss,-1,GT,loss,0,LE,*,1,UNKN,IF,median,*\" \\\r\n\"CDEF:meL0=me0,0.0004383744,-\" \\\r\n\"CDEF:meH0=me0,0,*,0.0004383744,2,*,+\" \\\r\n\"AREA:meL0\" \\\r\n\"STACK:meH0#26ff00:0\" \\\r\n\"CDEF:me1=loss,0,GT,loss,1,LE,*,1,UNKN,IF,median,*\" \\\r\n\"CDEF:meL1=me1,0.0004383744,-\" \\\r\n\"CDEF:meH1=me1,0,*,0.0004383744,2,*,+\" \\\r\n\"AREA:meL1\" \\\r\n\"STACK:meH1#00b8ff:1/20\" \\\r\n\"CDEF:me2=loss,1,GT,loss,2,LE,*,1,UNKN,IF,median,*\" \\\r\n\"CDEF:meL2=me2,0.0004383744,-\" \\\r\n\"CDEF:meH2=me2,0,*,0.0004383744,2,*,+\" \\\r\n\"AREA:meL2\" \\\r\n\"STACK:meH2#0059ff:2/20\" \\\r\n\"CDEF:me3=loss,2,GT,loss,3,LE,*,1,UNKN,IF,median,*\" \\\r\n\"CDEF:meL3=me3,0.0004383744,-\" \\\r\n\"CDEF:meH3=me3,0,*,0.0004383744,2,*,+\" \\\r\n\"AREA:meL3\" \\\r\n\"STACK:meH3#5e00ff:3/20\" \\\r\n\"CDEF:me4=loss,3,GT,loss,4,LE,*,1,UNKN,IF,median,*\" \\\r\n\"CDEF:meL4=me4,0.0004383744,-\" \\\r\n\"CDEF:meH4=me4,0,*,0.0004383744,2,*,+\" \\\r\n\"AREA:meL4\" \\\r\n\"STACK:meH4#7e00ff:4/20\" \\\r\n\"CDEF:me10=loss,4,GT,loss,10,LE,*,1,UNKN,IF,median,*\" \\\r\n\"CDEF:meL10=me10,0.0004383744,-\" \\\r\n\"CDEF:meH10=me10,0,*,0.0004383744,2,*,+\" \\\r\n\"AREA:meL10\" \\\r\n\"STACK:meH10#dd00ff:10/20\" \\\r\n\"CDEF:me19=loss,10,GT,loss,19,LE,*,1,UNKN,IF,median,*\" \\\r\n\"CDEF:meL19=me19,0.0004383744,-\" \\\r\n\"CDEF:meH19=me19,0,*,0.0004383744,2,*,+\" \\\r\n\"AREA:meL19\" \\\r\n\"STACK:meH19#ff0000:19/20\" \\\r\n\"COMMENT: \\l\" \\\r\n\"HRULE:0#000000\"<br />1\r\n\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}